from web3 import Web3
import json
import os

w3 = Web3(Web3.HTTPProvider(os.environ.get("WEB3_PROVIDER","http://localhost:8545")))

contract_address = os.environ.get("CONTRACT_ADDRESS")
abi = json.load(open("contract_abi.json"))

acct = w3.eth.accounts[0]
contract = w3.eth.contract(address=contract_address, abi=abi)

def write_hash(h):
    tx = contract.functions.logAudit(h).buildTransaction({
        'from': acct,
        'nonce': w3.eth.get_transaction_count(acct),
        'gas': 2000000
    })
    signed = w3.eth.account.sign_transaction(tx, private_key=os.environ.get("PRIVATE_KEY"))
    tx_hash = w3.eth.send_raw_transaction(signed.rawTransaction)
    return w3.toHex(tx_hash)

if __name__ == "__main__":
    print(write_hash("example_hash_here"))
